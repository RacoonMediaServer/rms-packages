syntax = "proto3";
import "google/protobuf/empty.proto";

option go_package = "../rms-library";

service Lists {
  // добавление указанного тайтла в указанный список
  rpc Add(ListsAddRequest) returns (google.protobuf.Empty);

  // перечислить элементы списка
  rpc List(ListsListRequest) returns (ListsListResponse);

  // переместить тайтл в другой список
  rpc Move(ListsMoveRequest) returns (google.protobuf.Empty);

  // удаление указанного тайтла из списка
  rpc Delete(ListsDeleteRequest) returns (google.protobuf.Empty);
}

service Torrents {
  // получить список раздач, принадлежащих указанному тайтлу
  rpc List(TorrentsListRequest) returns (TorrentsListResponse);

  // заменить указанную раздачу
  rpc Replace(TorrentsReplaceRequest) returns (google.protobuf.Empty);

  // найти альтернативные варианты раздачи
  rpc FindAlternatives(TorrentsFindAlternativesRequest) returns (TorrentsFindAlternativesResponse);

  // добавить раздачу к тайтлу
  rpc Add(TorrentsAddRequest) returns (google.protobuf.Empty);

  // удалить раздачу
  rpc Delete(TorrentsDeleteRequest) returns (google.protobuf.Empty);
}

service Movies {
  // поиск информации о фильмах и сериалах во внешних источниках
  rpc Search(MoviesSearchRequest) returns (MoviesSearchResponse);

  // получить инфу о фильме/сериале, присутствующем в библиотеке по его ID
  rpc Get(MoviesGetRequest) returns (MoviesGetResponse);

  // получить список доступных новых сезонов для скачивания
  rpc GetUpdates(google.protobuf.Empty) returns (MoviesGetUpdatesResponse);
}

service Music {
  // поиск информации о музыке во внешних источниках
  rpc Search(MusicSearchRequest) returns (MusicSearchResponse);

  // получить список доступных новых сезонов для скачивания
  rpc GetUpdates(google.protobuf.Empty) returns (MusicGetUpdatesResponse);
}

service Other {
  // поиск по торрентам
  rpc Search(OtherSearchRequest) returns (OtherSearchResponse);
}

// список тайтлов
enum List {
  // любимые тайтлы
  Favourites = 0;
  // список "к просмотру"
  WatchList = 1;
  // архив раздач
  Archive = 2;
}

enum ContentType {
  // видео - фильмы/сериалы/клипы
  TypeMovies = 0;
  // музыка
  TypeMusic = 1;
  // разное
  TypeOther = 2;
}

message Pagination {
  // смещение относительно первого результата
  uint32 offset = 1;

  // максимальное кол-во элементов
  uint32 count = 2;
}

message ListsAddRequest {
  // глобальный идентификатор тайтла
  string id = 1;

  // в какой список добавляем тайтл
  List list = 2;
}

message ListsListRequest {
  // элементы какого списка отобразить
  List list = 1;

  // тип медиа
  optional ContentType contentType = 2;

  // разбиение на страницы
  optional Pagination pagination = 3;
}

message ListItem {
  // идентификатор
  string id = 1;

  // название
  string title = 2;

  // тип медиа
  ContentType contentType = 3;

  // занимаемое на диске место (Мб)
  uint64 size = 4;
}

message ListsListResponse {
  // тайтлы
  repeated ListItem items = 1;
}

message ListsMoveRequest {
  // идентификатор
  string id = 1;

  // в какой список переместить
  List list = 2;
}

message ListsDeleteRequest {
  // идентификатор
  string id = 1;
}

message TorrentsListRequest {
  // идентификатор тайтла
  string id = 1;
}

// раздача на торренте
message Torrent {
  // ID для идентификации данной раздачи
  string id = 1;

  // заголовок раздачи
  string title = 2;

  // размер раздачи в мегабайтах
  uint64 size = 3;

  // кол-во раздающих
  uint32 seeders = 4;
}

message TorrentsListResponse {
  repeated Torrent torrents = 1;
}

message TorrentsReplaceRequest {
  // идентификатор тайтла
  string id = 1;

  // идентификатор раздачи
  string torrentId = 2;

  // идентификатор новой раздачи
  optional string newTorrentId = 3;

  // торрент-файл для замены
  optional bytes torrentFile = 4;
}

message TorrentsFindAlternativesRequest {
  // идентификатор тайтла
  string id = 1;

  // идентификатор раздачи
  string torrentId = 2;
}

message TorrentsFindAlternativesResponse {
  repeated Torrent torrents = 1;
}

message TorrentsAddRequest {
  // идентификатор тайтла
  string id = 1;

  // идентификатор новой раздачи
  string newTorrentId = 2;

  // торрент-файл для замены
  optional bytes torrentFile = 3;
}

message TorrentsDeleteRequest {
  // идентификатор тайтла
  string id = 1;

  // идентификатор раздачи
  string torrentId = 2;
}

// запрос на поиск во внешних источниках
message MoviesSearchRequest {
  string text = 1;
  uint32 limit = 2;
}

// тип медиа - фильм или сериал
enum MovieType {
  TvSeries = 0;
  Film = 1;
  Clip = 2;
}

// структура описывает общую информацию о фильме/сериале
message MovieInfo {
  string title = 1;
  string description = 2;
  uint32 year = 3;
  string poster = 4;
  repeated string genres = 5;
  float rating = 6;
  MovieType type = 7;
  optional uint32 seasons = 8;
  string originalTitle = 9;
}

// результат поиска по внешних источниках
message FoundMovie {
  // сквозной ID фильма/сериала
  string id = 1;

  // общая информация о Movie
  MovieInfo info = 2;

  // информация о скачанных сезонах
  repeated uint32 seasonsDownloaded = 3;
}

// результат поиска - несколько вариантов фильма/сериала
message MoviesSearchResponse {
  repeated FoundMovie movies = 1;
}

message MoviesGetRequest {
  // идентификатор тайтла
  string id = 1;
}

message MoviesGetResponse {
  // информация о тайтле
  MovieInfo info = 1;
}

// инфа о новых сезонах одного сериала
message TvSeriesUpdate {
  // сквозной ID фильма/сериала
  string id = 1;

  // общая информация о Movie
  MovieInfo info = 2;

  // перечисление новых доступных сезонов
  repeated uint32 seasonsAvailable = 3;
}

// результат запроса обновления сериалов
message MoviesGetUpdatesResponse {
  repeated TvSeriesUpdate updates = 1;
}

message Artist {
  string id = 1;
  string name = 2;
  string poster = 3;
  uint32 albums = 4;
}

message Album {
  string id = 1;
  string name = 2;
  string artist = 3;
  string title = 4;
	string poster = 5;
	string releaseDate = 6;
  repeated string genres = 7;
	uint32 tracks = 8;
}

message MusicSearchRequest {
  // текстовая строка поиска
  string text = 1;

  // ограничение на кол-во результатов
  uint32 limit = 2;
}

message MusicSearchResponse {
  repeated Artist artists = 1;
  repeated Album albums = 2;
}

message MusicUpdates {
  // описание артиста
  Artist artist = 1;
  // новые найденные альбомы
  repeated Album albums = 2;
} 

message MusicGetUpdatesResponse {
  repeated MusicUpdates updates = 1;
}

message OtherSearchRequest {
  // текст для поиска
  string text = 1;

  // ограничение кол-ва результатов
  uint32 limit = 2;
}

message OtherSearchResponse {
  repeated Torrent torrents = 1;
}
